<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <title>Password Protected Page</title>
    <style>
        html, body {
            margin: 0;
            width: 100%;
            height: 100%;
            font-family: Arial, Helvetica, sans-serif;
        }
        #dialogText {
            color: white;
            background-color: #333333;
        }
        
        #dialogWrap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: table;
            background-color: #EEEEEE;
        }
        
        #dialogWrapCell {
            display: table-cell;
            text-align: center;
            vertical-align: middle;
        }
        
        #mainDialog {
            max-width: 400px;
            margin: 5px;
            border: solid #AAAAAA 1px;
            border-radius: 10px;
            box-shadow: 3px 3px 5px 3px #AAAAAA;
            margin-left: auto;
            margin-right: auto;
            background-color: #FFFFFF;
            overflow: hidden;
            text-align: left;
        }
        #mainDialog > * {
            padding: 10px 30px;
        }
        #passArea {
            padding: 20px 30px;
            background-color: white;
        }
        #passArea > * {
            margin: 5px auto;
        }
        #pass {
            width: 100%;
            height: 40px;
            font-size: 30px;
        }
        
        #messageWrapper {
            float: left;
            vertical-align: middle;
            line-height: 30px;
        }
        
        .notifyText {
            display: none;
        }
        
        #invalidPass {
            color: red;
        }
        
        #success {
            color: green;
        }
        
        #submitPass {
            font-size: 20px;
            border-radius: 5px;
            background-color: #E7E7E7;
            border: solid gray 1px;
            float: right;
            cursor: pointer;
        }
        #contentFrame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #attribution {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            padding: 10px;
            font-weight: bold;
            font-size: 0.8em;
        }
        #attribution, #attribution a {
            color: #999;
        }
        .error {
            display: none;
            color: red;
        }
    </style>
  </head>
  <body>
    <iframe id="contentFrame" frameBorder="0" allowfullscreen></iframe>
    <div id="dialogWrap">
        <div id="dialogWrapCell">
            <div id="mainDialog">
                <div id="dialogText">Welcome to poopjai_offical_fans_club</div>
                
                <div id="passArea">
                    <div id="passwordPrompt">請DM<a href="https://www.instagram.com/poopjai_offical_fans_club/">@poopjai_offical_fans_club</a><a>以取得密碼</a></div>
                    <p id="passwordPrompt">請輸入登入密碼:</p>
                    <input id="pass" type="password" name="pass" autofocus>
                    <div>
                        <span id="messageWrapper">
                            <span id="invalidPass" class="error">密碼錯誤，請重試</span>
                            <span id="trycatcherror" class="error">發生錯誤，請稍後再試</span>
                            <span id="success" class="notifyText">正在進入...請稍後...</span>
                            &nbsp;
                        </span>
                        <button id="submitPass" type="button">登入</button>
                        <div style="clear: both;"></div>
                    </div>
                </div>
                <div id="securecontext" class="error">
                    <p>
                        Sorry, but password protection only works over a secure connection. Please load this page via HTTPS.
                    </p>
                </div>
                <div id="nocrypto" class="error">
                    <p>
                        Your web browser appears to be outdated. Please visit this page using a modern browser.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <script>
    (function() {

        var pl = "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";
        
        var submitPass = document.getElementById('submitPass');
        var passEl = document.getElementById('pass');
        var invalidPassEl = document.getElementById('invalidPass');
        var trycatcherror = document.getElementById('trycatcherror');
        var successEl = document.getElementById('success');
        var contentFrame = document.getElementById('contentFrame');
        
        // Sanity checks

        if (pl === "") {
            submitPass.disabled = true;
            passEl.disabled = true;
            alert("This page is meant to be used with the encryption tool. It doesn't work standalone.");
            return;
        }

        if (!isSecureContext) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#securecontext").style.display = "block";
            return;
        }

        if (!crypto.subtle) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#nocrypto").style.display = "block";
            return;
        }
        
        function str2ab(str) {
            var ustr = atob(str);
            var buf = new ArrayBuffer(ustr.length);
            var bufView = new Uint8Array(buf);
            for (var i=0, strLen=ustr.length; i < strLen; i++) {
                bufView[i] = ustr.charCodeAt(i);
            }
            return bufView;
        }

        async function deriveKey(salt, password) {
            const encoder = new TextEncoder()
            const baseKey = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password),
                'PBKDF2',
                false,
                ['deriveKey'],
            )
            return await crypto.subtle.deriveKey(
                { name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' },
                baseKey,
                { name: 'AES-GCM', length: 256 },
                true,
                ['decrypt'],
            )
        }
        
        async function doSubmit(evt) {
            submitPass.disabled = true;
            passEl.disabled = true;

            let iv, ciphertext, key;
            
            try {
                var unencodedPl = str2ab(pl);

                const salt = unencodedPl.slice(0, 32)
                iv = unencodedPl.slice(32, 32 + 16)
                ciphertext = unencodedPl.slice(32 + 16)

                key = await deriveKey(salt, passEl.value);
            } catch (e) {
                trycatcherror.style.display = "inline";
                console.error(e);
                return;
            }

            try {
                const decryptedArray = new Uint8Array(
                    await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ciphertext)
                );

                let decrypted = new TextDecoder().decode(decryptedArray);

                if (decrypted === "") throw "No data returned";

                const basestr = '<base href="." target="_top">';
                const anchorfixstr = `
                    <script>
                        Array.from(document.links).forEach((anchor) => {
                            const href = anchor.getAttribute("href");
                            if (href.startsWith("#")) {
                                anchor.addEventListener("click", function(e) {
                                    e.preventDefault();
                                    const targetId = this.getAttribute("href").substring(1);
                                    const targetEl = document.getElementById(targetId);
                                    targetEl.scrollIntoView();
                                });
                            }
                        });
                    <\/script>
                `;
                
                // Set default iframe link targets to _top so all links break out of the iframe
                if (decrypted.includes("<head>")) decrypted = decrypted.replace("<head>", "<head>" + basestr);
                else if (decrypted.includes("<!DOCTYPE html>")) decrypted = decrypted.replace("<!DOCTYPE html>", "<!DOCTYPE html>" + basestr);
                else decrypted = basestr + decrypted;

                // Fix fragment links
                if (decrypted.includes("</body>")) decrypted = decrypted.replace("</body>", anchorfixstr + '</body>');
                else if (decrypted.includes("</html>")) decrypted = decrypted.replace("</html>", anchorfixstr + '</html>');
                else decrypted = decrypted + anchorfixstr;
                
                contentFrame.srcdoc = decrypted;
                
                successEl.style.display = "inline";
                setTimeout(function() {
                    dialogWrap.style.display = "none";
                }, 1000);
            } catch (e) {
                invalidPassEl.style.display = "inline";
                passEl.value = "";
                submitPass.disabled = false;
                passEl.disabled = false;
                console.error(e);
                return;
            }
        }
        
        submitPass.onclick = doSubmit;
        passEl.onkeypress = function(e){
            if (!e) e = window.event;
            var keyCode = e.keyCode || e.which;
            invalidPassEl.style.display = "none";
            if (keyCode == '13'){
              // Enter pressed
              doSubmit();
              return false;
            }
        }
    })();
    </script>
  </body>
</html>
