<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <title>Password Protected Page</title>
    <style>
        html, body {
            margin: 0;
            width: 100%;
            height: 100%;
            font-family: Arial, Helvetica, sans-serif;
        }
        #dialogText {
            color: white;
            background-color: #333333;
        }
        
        #dialogWrap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: table;
            background-color: #EEEEEE;
        }
        
        #dialogWrapCell {
            display: table-cell;
            text-align: center;
            vertical-align: middle;
        }
        
        #mainDialog {
            max-width: 400px;
            margin: 5px;
            border: solid #AAAAAA 1px;
            border-radius: 10px;
            box-shadow: 3px 3px 5px 3px #AAAAAA;
            margin-left: auto;
            margin-right: auto;
            background-color: #FFFFFF;
            overflow: hidden;
            text-align: left;
        }
        #mainDialog > * {
            padding: 10px 30px;
        }
        #passArea {
            padding: 20px 30px;
            background-color: white;
        }
        #passArea > * {
            margin: 5px auto;
        }
        #pass {
            width: 100%;
            height: 40px;
            font-size: 30px;
        }
        
        #messageWrapper {
            float: left;
            vertical-align: middle;
            line-height: 30px;
        }
        
        .notifyText {
            display: none;
        }
        
        #invalidPass {
            color: red;
        }
        
        #success {
            color: green;
        }
        
        #submitPass {
            font-size: 20px;
            border-radius: 5px;
            background-color: #E7E7E7;
            border: solid gray 1px;
            float: right;
            cursor: pointer;
        }
        #contentFrame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #attribution {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            padding: 10px;
            font-weight: bold;
            font-size: 0.8em;
        }
        #attribution, #attribution a {
            color: #999;
        }
        .error {
            display: none;
            color: red;
        }
    </style>
  </head>
  <body>
    <iframe id="contentFrame" frameBorder="0" allowfullscreen></iframe>
    <div id="dialogWrap">
        <div id="dialogWrapCell">
            <div id="mainDialog">
                <div id="dialogText">Welcome to poopjai_offical_fans_club</div>
                
                <div id="passArea">
                    <div id="passwordPrompt">請DM<a href="https://www.instagram.com/poopjai_offical_fans_club/">@poopjai_offical_fans_club</a><a>以取得密碼</a></div>
                    <p id="passwordPrompt">請輸入登入密碼:</p>
                    <input id="pass" type="password" name="pass" autofocus>
                    <div>
                        <span id="messageWrapper">
                            <span id="invalidPass" class="error">密碼錯誤，請重試</span>
                            <span id="trycatcherror" class="error">發生錯誤，請稍後再試</span>
                            <span id="success" class="notifyText">正在進入...請稍後...</span>
                            &nbsp;
                        </span>
                        <button id="submitPass" type="button">登入</button>
                        <div style="clear: both;"></div>
                    </div>
                </div>
                <div id="securecontext" class="error">
                    <p>
                        Sorry, but password protection only works over a secure connection. Please load this page via HTTPS.
                    </p>
                </div>
                <div id="nocrypto" class="error">
                    <p>
                        Your web browser appears to be outdated. Please visit this page using a modern browser.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <script>
    (function() {

        var pl = "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";
        
        var submitPass = document.getElementById('submitPass');
        var passEl = document.getElementById('pass');
        var invalidPassEl = document.getElementById('invalidPass');
        var trycatcherror = document.getElementById('trycatcherror');
        var successEl = document.getElementById('success');
        var contentFrame = document.getElementById('contentFrame');
        
        // Sanity checks

        if (pl === "") {
            submitPass.disabled = true;
            passEl.disabled = true;
            alert("This page is meant to be used with the encryption tool. It doesn't work standalone.");
            return;
        }

        if (!isSecureContext) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#securecontext").style.display = "block";
            return;
        }

        if (!crypto.subtle) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#nocrypto").style.display = "block";
            return;
        }
        
        function str2ab(str) {
            var ustr = atob(str);
            var buf = new ArrayBuffer(ustr.length);
            var bufView = new Uint8Array(buf);
            for (var i=0, strLen=ustr.length; i < strLen; i++) {
                bufView[i] = ustr.charCodeAt(i);
            }
            return bufView;
        }

        async function deriveKey(salt, password) {
            const encoder = new TextEncoder()
            const baseKey = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password),
                'PBKDF2',
                false,
                ['deriveKey'],
            )
            return await crypto.subtle.deriveKey(
                { name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' },
                baseKey,
                { name: 'AES-GCM', length: 256 },
                true,
                ['decrypt'],
            )
        }
        
        async function doSubmit(evt) {
            submitPass.disabled = true;
            passEl.disabled = true;

            let iv, ciphertext, key;
            
            try {
                var unencodedPl = str2ab(pl);

                const salt = unencodedPl.slice(0, 32)
                iv = unencodedPl.slice(32, 32 + 16)
                ciphertext = unencodedPl.slice(32 + 16)

                key = await deriveKey(salt, passEl.value);
            } catch (e) {
                trycatcherror.style.display = "inline";
                console.error(e);
                return;
            }

            try {
                const decryptedArray = new Uint8Array(
                    await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ciphertext)
                );

                let decrypted = new TextDecoder().decode(decryptedArray);

                if (decrypted === "") throw "No data returned";

                const basestr = '<base href="." target="_top">';
                const anchorfixstr = `
                    <script>
                        Array.from(document.links).forEach((anchor) => {
                            const href = anchor.getAttribute("href");
                            if (href.startsWith("#")) {
                                anchor.addEventListener("click", function(e) {
                                    e.preventDefault();
                                    const targetId = this.getAttribute("href").substring(1);
                                    const targetEl = document.getElementById(targetId);
                                    targetEl.scrollIntoView();
                                });
                            }
                        });
                    <\/script>
                `;
                
                // Set default iframe link targets to _top so all links break out of the iframe
                if (decrypted.includes("<head>")) decrypted = decrypted.replace("<head>", "<head>" + basestr);
                else if (decrypted.includes("<!DOCTYPE html>")) decrypted = decrypted.replace("<!DOCTYPE html>", "<!DOCTYPE html>" + basestr);
                else decrypted = basestr + decrypted;

                // Fix fragment links
                if (decrypted.includes("</body>")) decrypted = decrypted.replace("</body>", anchorfixstr + '</body>');
                else if (decrypted.includes("</html>")) decrypted = decrypted.replace("</html>", anchorfixstr + '</html>');
                else decrypted = decrypted + anchorfixstr;
                
                contentFrame.srcdoc = decrypted;
                
                successEl.style.display = "inline";
                setTimeout(function() {
                    dialogWrap.style.display = "none";
                }, 1000);
            } catch (e) {
                invalidPassEl.style.display = "inline";
                passEl.value = "";
                submitPass.disabled = false;
                passEl.disabled = false;
                console.error(e);
                return;
            }
        }
        
        submitPass.onclick = doSubmit;
        passEl.onkeypress = function(e){
            if (!e) e = window.event;
            var keyCode = e.keyCode || e.which;
            invalidPassEl.style.display = "none";
            if (keyCode == '13'){
              // Enter pressed
              doSubmit();
              return false;
            }
        }
    })();
    </script>
  </body>
</html>
